// --- Modal Data (MERGED) ---
const modalData = {
    // === Your new data for modals 1-6 ===
    "modal-1": {
        title: "Automated Oil Palm Detection",
        keywords: ["Python", "AI", "Machine Learning", "YOLO", "Automation"],
        description: `
            <h3>üå≥ Automated Oil Palm Tree Detection</h3>
            <p>This Final Year Project focused on developing a highly precise and automated system for agricultural monitoring within oil palm plantations using cutting-edge AI technology.</p>
            <h4>The Challenge & Goal</h4>
            <p>The objective was to accurately identify and locate mature oil palm trees and deboling holes within plantation imagery, significantly reducing manual survey costs and errors.</p>
            <h4>The Solution</h4>
            <p>Successfully leveraged state-of-the-art YOLO deep learning models for robust object detection. The research involved comparative analysis of different YOLO architectures to achieve maximum accuracy and efficiency.</p>
            <h4>Key Focus Areas</h4>
            <ul>
                <li><strong>Technology:</strong> Deep Learning with YOLO model training and fine-tuning</li>
                <li><strong>Application:</strong> Precision agriculture and automated inventory monitoring</li>
                <li><strong>Outcome:</strong> Established benchmark for high-accuracy detection in challenging plantation environments</li>
            </ul>
        `,
        images: ["images/contents/palms/vale_poster.jpg","images/contents/palms/FullStack.jpg", "images/contents/palms/Poster.jpg", "images/contents/palms/Detection.jpg"]
    },
    "modal-2": {
        title: "Ultra Dim - Super Dimmer APK",
        keywords: ["Flutter", "Mobile Development", "Android", "UI/UX"],
        description: `
            <h3>üåô Ultra Dim ‚Äì Safer Night Driving App</h3>
            <p>Ultra Dim is a Flutter mobile application designed to solve a critical safety and comfort issue for drivers using Android-based car players.</p>
            <h4>The Challenge</h4>
            <p>During night driving, many car displays remain too bright even at the lowest system setting, causing eye strain, distraction, and reduced driving safety.</p>
            <h4>The Solution</h4>
            <p>Ultra Dim provides an "ultra-dim" solution beyond standard system limits by intelligently combining system brightness control with a transparent, low-opacity overlay for genuinely comfortable night use.</p>
            <h4>Key Technology</h4>
            <ul>
                <li><strong>Platform:</strong> Flutter (Cross-platform framework)</li>
                <li><strong>Target:</strong> Android-based Car Head Units</li>
                <li><strong>Impact:</strong> Enhanced driving safety through reduced eye strain</li>
            </ul>
        `,
        images: ["images/contents/dims/super_dim.png"]
    },
    "modal-3": {
        title: "Trombol Paradise Beach App",
        keywords: ["UI/UX Design", "Mobile App", "Figma", "eCommerce"],
        description: `
            <h3>üèñÔ∏è Trombol Paradise Beach App Concept</h3>
            <p>A comprehensive UI/UX concept for Paradise Beach resort in Trombol, designed to provide guests with a clean, intuitive, and engaging mobile experience.</p>
            <h4>Key Features Designed:</h4>
            <ul>
                <li><strong>Splash & Auth:</strong> Professional login/signup flow ensuring secure and accessible user accounts</li>
                <li><strong>Home Dashboard:</strong> Dynamic main page highlighting promotions and providing clear navigation</li>
                <li><strong>Service Categories:</strong> Grid-based system for easy browsing of Activities, Services, Products, and Dining</li>
                <li><strong>eCommerce:</strong> Integrated cart and profile system for booking services and purchasing products</li>
            </ul>
        `,
        images: ["images/contents/trombol/Trombol_Main_Page.jpg", "images/contents/trombol/Trombol_signin.jpg"]
    },
    "modal-4": {
        title: "UNIMAS AR Navigator App",
        keywords: ["Flutter", "Augmented Reality", "WebAR", "Mobile Development"],
        description: `
            <h3>üó∫Ô∏è UNIMAS AR Navigator App</h3>
            <p>A fully functional augmented reality navigation solution specifically designed for exploring the UNIMAS campus with immersive, real-time guidance.</p>
            <h4>The Goal</h4>
            <p>Provide students, staff, and visitors with a dynamic and intuitive way to navigate university grounds, moving beyond static maps to offer an immersive experience.</p>
            <h4>The Solution & Technology</h4>
            <p>Built using Flutter SDK within Android Studio for high-performance, cross-platform mobile experience. Features sophisticated WebAR integration for seamless AR element rendering.</p>
            <h4>Key Features</h4>
            <ul>
                <li><strong>Platform:</strong> Flutter SDK (Android development)</li>
                <li><strong>Core Technology:</strong> Augmented Reality navigation</li>
                <li><strong>Integration:</strong> WebAR for dynamic, in-browser AR experiences</li>
                <li><strong>Application:</strong> Intuitive campus exploration and guidance</li>
            </ul>
        `,
        images: ["images/contents/ar/UNIMAS_AR_mainpage.jpg", "images/contents/ar/Unimas_AR.jpg"]
    },
    "modal-5": {
        title: "Global Connection System",
        keywords: ["Mobile Development", "UI/UX Design", "Community Empowerment", "Local Tourism"],
        description: `
            <h3>üåê Global Connection System</h3>
            <p>This project is a mobile application designed to foster community empowerment and sustainable development by providing accessible community training and promoting local tourism and culture.</p>
            <h4>The Challenge & Goal</h4>
            <p>The objective was to create a centralized, user-friendly digital hub that connects global resources with local communities, specifically focusing on upskilling women and villagers, and driving economic growth through local tourism promotion.</p>
            <h4>The Solution</h4>
            <p>Developed a platform with three core areas: seamless account creation via Google/Apple, a structured Community Training section (featuring videos on web creation, marketing, and local crafts), and a Local Tourism marketplace (for booking homestays, river tours, and village visits).</p>
            <h4>Key Focus Areas</h4>
            <ul>
                <li><strong>Design & UX:</strong> Creating an intuitive, dark-mode-first user interface for easy navigation and content consumption.</li>
                <li><strong>Community Support:</strong> Curating and presenting training materials for entrepreneurship and skill development.</li>
                <li><strong>Local Economy:</strong> Facilitating direct bookings for local tourism services (Places & Bookings).</li>
            </ul>
        `,
        images: ["images/contents/global/gsc2.png", "images/contents/global/gsc1.png", "images/contents/global/gsc3.png"]
    },
    "modal-6": {
        title: "Personal Finance Management App",
        keywords: ["UI/UX Design", "Mobile App", "FinTech", "Data Visualization"],
        description: `
            <h3>üí∞ Personal Finance Management App</h3>
            <p>This project is a mobile application focused on empowering users with tools for effective personal finance management, encompassing expense tracking, budgeting, savings, and financial education.</p>
            <h4>The Challenge & Goal</h4>
            <p>The objective was to create an engaging and accessible platform that simplifies the often complex task of personal finance. The goal was to help users visualize spending habits, stay within budget limits, and easily access resources for financial growth.</p>
            <h4>The Solution</h4>
            <p>Designed a user experience centered around a clear Dashboard featuring expense statistics (pie chart), budget limit tracking (bar chart), and progress on Saving Goals. The app also includes dedicated sections for Motivation Videos and an Investment App hub linking to popular regional financial services (e.g., myASNB, Touch 'n Go eWallet, Versa).</p>
            <h4>Key Focus Areas</h4>
            <ul>
                <li><strong>Data Visualization:</strong> Using clear charts (pie and bar) to communicate complex financial data at a glance, with immediate feedback (e.g., "You've gone over budget!").</li>
                <li><strong>Holistic Financial Health:</strong> Integrating budgeting and saving tools with educational content and links to external investment opportunities.</li>
                <li><strong>UX/UI:</strong> Employing a friendly, minimal design palette and clear navigation structure (bottom tab bar for Expenses, Saving goals, Budget, Settings).</li>
            </ul>
        `,
        images: ["images/contents/fma/login.png", "images/contents/fma/dashboard.png", "images/contents/fma/invest.png","images/contents/fma/motivation.png"]
    },
    
    // === "Ongoing" data from your original file ===
    "modal-7": {
        title: "Project: Bookabary",
        keywords: [
            "Flutter", 
            "Supabase", 
            "PostgreSQL", 
            "Full-Stack", 
            "Google Books API", 
            "TMDB API", 
            "UI/UX"
        ],
        description: `
            <p>An in-progress, full-stack personal media library application. Bookabary is designed to be a single, beautiful app to scan, track, and organize your physical books and movies.</p>
            <p><strong>Tech Stack:</strong> Flutter (Frontend), Supabase (Backend/Database/Auth), Google Books API, The Movie Database (TMDB) API.</p>
            
            <h3>Core User Features</h3>
            <ul>
                <li><strong>Barcode-Powered Data Entry:</strong> Instantly scan a book's ISBN or movie's UPC to add it.</li>
                <li><strong>Automated Media Details:</strong> Fetches cover art, summaries, cast, ratings, and more from external APIs.</li>
                <li><strong>Personalized Digital Shelves:</strong> Organize media into custom-status shelves (e.g., "Read," "Currently Reading," "Want to Watch").</li>
                <li><strong>Personal Ratings & Notes:</strong> Add 1-5 star ratings and private notes to any item.</li>
                <li><strong>Manual Search Fallback:</strong> Manually search and add items that don't have a barcode.</li>
            </ul>

            <h3>Full-Stack & API Features</h3>
            <ul>
                <li><strong>Secure User Authentication:</strong> Full email, password, and social logins handled by Supabase Auth.</li>
                <li><strong>Third-Party API Integration:</strong> Fetches and parses complex JSON responses from Google Books & TMDB.</li>
                <li><strong>Proprietary Cloud Database:</strong> User data (ratings, notes, collections) is saved to a custom-structured PostgreSQL database.</li>
                <li><strong>Optimized Data Storage:</strong> Saves clean, parsed data to the app's own database for instant loads.</li>
                <li><strong>Row-Level Security (RLS):</strong> Backend database rules ensure users can only access their own data.</li>
            </ul>

            <h3>"In-Progress" & Roadmap Features</h3>
            <ul>
                <li><strong>Currently Building:</strong> A statistics dashboard for fun insights (e.g., "You've read 12 books this year").</li>
                <li><strong>Next Up:</strong> A dedicated "Wishlist" feature.</li>
                <li><strong>Future Goal:</strong> A "Discovery" feed to suggest new media based on user ratings.</li>
            </ul>
        `,
        images: [] // <-- Add your image paths here! e.g., 'images/bookabary_scan.png'
    },
    "modal-ongoing-1": {
        title: "XAI-PE Analyzer: Explainable Malware Detection",
        keywords: ["Python", "XGBoost", "SHAP", "Malware Analysis", "XAI"],
        description: `
            <p>An ongoing machine learning project building an Explainable AI (XAI) tool for static analysis of Windows Portable Executables (PE). Provides high-accuracy malware prediction with detailed, human-readable explanations.</p>
            <p><strong>Tech Stack:</strong> Python, XGBoost/LightGBM (Model), pefile (Feature Extraction), SHAP (XAI), NVIDIA CUDA (GPU Acceleration).</p>
            
            <h3>Key Features</h3>
            <ul>
                <li><strong>Explainable Prediction:</strong> Doesn't just classify, but provides the why: e.g., "Malware Detected due to 'Function Call X' and 'High Entropy Section Y'."</li>
                <li><strong>Static Analysis:</strong> Safely extracts features from PE file headers (e.g., imports, section data) using pefile without execution.</li>
                <li><strong>Large-Scale Training:</strong> Model trained on the EMBER dataset (1.1M files), utilizing GPU acceleration (tree_method='gpu_hist') for optimized performance.</li>
            </ul>

            <h3>Roadmap</h3>
            <ul>
                <li><strong>Current Focus:</strong> Developing a streamlined, interactive dashboard for SHAP-based feature explanation visualization.</li>
                <li><strong>Next Up:</strong> Implementing an automated continuous training pipeline to refresh the model with new data.</li>
            </ul>
        `,
        images: []
    },
    "modal-ongoing-2": {
        title: "Campus Safety AR Module",
        keywords: ["Unity", "AR", "GPS", "Safety", "UNIMAS"],
        description: `
            <p><strong>This project is currently in development.</strong></p>
            <p>This is a planned add-on for the UNIMAS AR Navigator application. The module will focus on enhancing campus safety by providing real-time, AR-guided emergency routes.</p>
            
            <h3>Planned Features</h3>
            <ul>
                <li>Overlay AR exit signs and pathways during emergency drills or alerts.</li>
                <li>Integrate with campus security systems to highlight "safe zones."</li>
                <li>Provide the quickest AR route to the nearest assembly point.</li>
            </ul>
        `,
        images: []
    },
    "modal-ongoing-3": {
        title: "Plantation Health Dashboard",
        keywords: ["React", "Data Visualization", "Firebase", "Web App"],
        description: `
            <p><strong>This project is currently in development.</strong></p>
            <p>A web-based dashboard designed to visualize the data collected from the "AI Palm Tree Detection" project. This will provide plantation managers with an easy-to-understand visual interface to monitor crop health.</p>
            
            <h3>Planned Features</h3>
            <ul>
                <li>An interactive map showing the health status of individual trees.</li>
                <li>Charts and graphs for tracking health trends over time.</li>
                <li>Automated reports and alerts for areas requiring attention.</li>
                <li>Secure login for managers and administrators.</li>
            </ul>
        `,
        images: []
    }
};

// --- Modal Functions (Unchanged) ---
const projectModal = document.getElementById('project-modal');
const modalTitle = document.getElementById('modal-title');
const modalKeywords = document.getElementById('modal-keywords');
const modalDescription = document.getElementById('modal-description');
const modalImages = document.getElementById('modal-images');

function openProjectModal(data) {
    modalTitle.textContent = data.title;
    
    modalKeywords.innerHTML = '';
    data.keywords.forEach(keyword => {
        const tag = document.createElement('span');
        tag.className = 'keyword-tag';
        tag.textContent = keyword;
        modalKeywords.appendChild(tag);
    });
    
    modalDescription.innerHTML = data.description;
    
    modalImages.innerHTML = '';
    data.images.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = data.title;
        modalImages.appendChild(img);
    });
    
    projectModal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal(modal) {
    modal.classList.remove('active');
    document.body.style.overflow = '';
}


document.addEventListener("DOMContentLoaded", () => {

    // --- FIX 1: PREVENT ANCHOR JUMP (Unchanged) ---
    window.scrollTo(0, 0);
    
    // --- NEW PRELOADER & SCROLL-LOCK (Your splash screen) ---
    // Prevent scrolling while the preloader is visible
    document.body.style.overflow = 'hidden';

    // Helper function for delays
    const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // The new asynchronous preloader animation
    async function startHackerAnimation() {
        const preloader = document.getElementById('preloader');
        const loaderText = document.getElementById('hacker-loader-text');
        const nameEl = document.getElementById('hacker-name');
        const accessEl = document.getElementById('access-granted');
        
        if (!loaderText || !nameEl || !accessEl) {
             console.error('Preloader elements not found. Skipping animation.');
             // Failsafe: just load the site
             document.body.classList.add('loaded');
             preloader.addEventListener('transitionend', () => {
                preloader.style.display = 'none';
                document.body.style.overflow = '';
             });
             return;
        }

        const messages = [
            "Initializing kernel...",
            "Establishing secure link...",
            "Scanning for Nasi Lemak...",
            "Bypassing firewalls...",
            "Patting the cats...",
            "Killing the bots...",
            "Accessing portfolio..."
        ];

        // Phase 1: Type out loading messages
        for (const msg of messages) {
            loaderText.textContent = `> ${msg}`;
            await wait(300); // Time each message is displayed
        }
        
        await wait(400);
        loaderText.textContent = "> Loading complete.";
        await wait(300);

        // Phase 2: Decode Name
        nameEl.classList.add('visible');
        const finalName = nameEl.getAttribute('data-value');
        // All caps and symbols for the "hacker" effect
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*&%$#@!";
        let iterations = 0;
        
        const interval = setInterval(() => {
            nameEl.textContent = finalName.split("")
                .map((letter, index) => {
                    // If we've already resolved this letter, keep it
                    if(index < iterations) {
                        return finalName[index];
                    }
                    // Otherwise, pick a random char
                    return chars[Math.floor(Math.random() * chars.length)];
                })
                .join("");
            
            // If we've resolved the whole name, stop
            if(iterations >= finalName.length) {
                clearInterval(interval);
            }
            
            // Controls how many letters are "decoded" per frame
            iterations += 1 / 1;
        }, 40); // Animation refresh rate

        // Wait for the decode animation to finish
        await wait(finalName.length * 120 + 500);

        // Phase 3: Show Access Granted
        accessEl.classList.add('visible');
        
        // ---
        // *** THIS IS THE CHANGE FOR SMOOTHNESS ***
        // Was 1000, now it's much shorter
        await wait(10); 
        // ---
        
        // Phase 4: Trigger Fade-Out
        document.body.classList.add('loaded');
    }
    
    // --- Main Load Event (Updated) ---
    window.addEventListener('load', () => {
        const preloader = document.getElementById('preloader');

        // Set up the listener for when the fade-out is DONE
        preloader.addEventListener('transitionend', () => {
            preloader.style.display = 'none';
            // Restore scrolling now that the preloader is gone
            document.body.style.overflow = '';
        }, { once: true }); // Ensure this only runs once

        // Start the new hacker animation sequence
        startHackerAnimation();
    });

    // --- Custom Cursor Logic (Unchanged from your file) ---
    const cursorOrb = document.querySelector('.cursor-orb');

    document.addEventListener('mousemove', (e) => {
        if (cursorOrb) {
            cursorOrb.style.left = e.clientX + 'px';
            cursorOrb.style.top = e.clientY + 'px';
        }
    });

    // --- Cursor Interaction Logic (Unchanged from your file) ---
    const interactiveElements = document.querySelectorAll(
        'a, .project-card, .close-button, .btn'
    );
    
    interactiveElements.forEach(el => {
        el.addEventListener('mouseenter', () => {
            document.body.classList.add('cursor-hover');
        });
        el.addEventListener('mouseleave', () => {
            document.body.classList.remove('cursor-hover');
        });
    });


    // --- Header Scroll Logic (Unchanged) ---
    let lastScroll = 0;
    const header = document.querySelector('header');
    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        if (header) {
            if (currentScroll > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
            if (currentScroll > lastScroll && currentScroll > 200) {
                header.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
            }
        }
        lastScroll = currentScroll;
    });

    // --- Fade-in Observer (Unchanged) ---
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    document.querySelectorAll('.fade-in').forEach(el => {
        observer.observe(el);
    });

    // --- Typing Text (Unchanged) ---
    const typingTextElement = document.querySelector(".typing-text");
    if (typingTextElement) {
        const words = typingTextElement.getAttribute('data-words').split(',');
        let wordIndex = 0;
        let charIndex = 0;
        let isDeleting = false;

        function type() {
            const currentWord = words[wordIndex];
            if (isDeleting) {
                typingTextElement.textContent = currentWord.substring(0, charIndex - 1);
                charIndex--;
            } else {
                typingTextElement.textContent = currentWord.substring(0, charIndex + 1);
                charIndex++;
            }
            let typeSpeed = 150;
            if (isDeleting) {
                typeSpeed /= 2;
            }
            if (!isDeleting && charIndex === currentWord.length) {
                typeSpeed = 2000; 
                isDeleting = true;
            } 
            else if (isDeleting && charIndex === 0) {
                isDeleting = false;
                wordIndex = (wordIndex + 1) % words.length; 
                typeSpeed = 500; 
            }
            setTimeout(type, typeSpeed);
        }
        type(); 
    }

    // --- Smooth Scroll (Unchanged) ---
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            if (href && href.startsWith('#') && href.length > 1 && href !== '#contact-link') { 
                e.preventDefault();
                try {
                    const target = document.querySelector(href);
                    if (target) {
                        const headerOffset = 100;
                        const elementPosition = target.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({
                            top: offsetPosition,
                            behavior: 'smooth'
                        });
                    }
                } catch (error) {
                    console.error("Error in smooth scroll:", error);
                }
            }
        });
    });

    // --- Modal Event Listeners (Unchanged) ---
    document.querySelectorAll('.project-card').forEach(card => {
        card.addEventListener('click', () => {
            const modalId = card.getAttribute('data-modal');
            const data = modalData[modalId];
            if (data) {
                openProjectModal(data);
            } else {
                console.warn(`No modal data found for ID: ${modalId}`);
            }
        });
    });

    document.querySelectorAll('.close-button').forEach(btn => {
        btn.addEventListener('click', () => {
            closeModal(btn.closest('.modal'));
        });
    });

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal(modal);
        });
    });

    const contactLink = document.getElementById('contact-link');
    const contactModal = document.getElementById('contact-modal');
    if (contactLink && contactModal) {
        contactLink.addEventListener('click', (e) => {
            e.preventDefault();
            contactModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    }
    
    document.addEventListener('keydown', (e) => {
        if (e.key === "Escape") {
            document.querySelectorAll('.modal.active').forEach(modal => {
                closeModal(modal);
            });
        }
    });

    // --- Hero Parallax (Unchanged) ---
    const hero = document.querySelector('.hero-section');
    if (hero) {
        document.addEventListener('mousemove', (e) => {
            const xMovement = (e.clientX - window.innerWidth / 2) / window.innerWidth * 20; 
            const yMovement = (e.clientY - window.innerHeight / 2) / window.innerHeight * 20;
            const pos1X = 20 - xMovement;
            const pos1Y = 50 - yMovement;
            const pos2X = 80 - xMovement;
            const pos2Y = 80 - yMovement;
            hero.style.backgroundPosition = `${pos1X}% ${pos1Y}%, ${pos2X}% ${pos2Y}%`;
        });
    }

});
